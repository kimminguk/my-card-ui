# íšŒì› ìŠ¹ì¸ í›„ íšŒì› ê´€ë¦¬ ëª©ë¡ ì—°ë™ ìˆ˜ì • ë‚´ì—­

## ğŸ” ë¬¸ì œ ìƒí™©
- íšŒì›ê°€ì… â†’ ê´€ë¦¬ì ìŠ¹ì¸ì€ ì •ìƒ ì‘ë™
- ìŠ¹ì¸ëœ íšŒì›ì€ ë¡œê·¸ì¸ ê°€ëŠ¥
- **í•˜ì§€ë§Œ ê´€ë¦¬ì í˜ì´ì§€ì˜ íšŒì› ê´€ë¦¬ ëª©ë¡ì—ì„œ ìŠ¹ì¸ëœ íšŒì›ì´ í‘œì‹œë˜ì§€ ì•ŠìŒ**

## ğŸ’¡ ì›ì¸ ë¶„ì„
- íšŒì› ìŠ¹ì¸ ì‹œìŠ¤í…œì€ ìƒˆë¡œìš´ `users_management.json` íŒŒì¼ ì‚¬ìš©
- íšŒì› ê´€ë¦¬ ëª©ë¡ ì¡°íšŒ í•¨ìˆ˜(`utils.py`ì˜ `get_all_users()`)ëŠ” ê¸°ì¡´ ì‹œìŠ¤í…œ ì°¸ì¡°
- ë‘ ì‹œìŠ¤í…œ ê°„ì˜ ì—°ë™ ë¶€ì¬ë¡œ ì¸í•œ ë°ì´í„° ë¶ˆì¼ì¹˜

## ğŸ› ï¸ ìˆ˜ì • íŒŒì¼ ë° ë‚´ìš©

### 1. `utils.py` íŒŒì¼ ìˆ˜ì •

#### ğŸ“ ìˆ˜ì • ìœ„ì¹˜: `get_all_users()` í•¨ìˆ˜ (763ë²ˆì§¸ ì¤„ë¶€í„°)

**ğŸ”´ ìˆ˜ì • ì „:**
```python
def get_all_users() -> List[Dict]:
    """
    ì „ì²´ ì‚¬ìš©ì ëª©ë¡ ë°˜í™˜ (ìŠ¹ì¸ëœ ì‚¬ìš©ì í¬í•¨ + ë°ì´í„° ì •ê·œí™”)

    ì‹œìŠ¤í…œì— ë“±ë¡ëœ ëª¨ë“  ì‚¬ìš©ìë¥¼ ì¡°íšŒí•˜ë©´ì„œ:
    1. users_data.jsonì˜ ê¸°ì¡´ ë“±ë¡ ì‚¬ìš©ì
    2. knowledge_data.jsonì˜ ìŠ¹ì¸ëœ ì‚¬ìš©ì (approved_users)
    ë ˆê±°ì‹œ ë°ì´í„° í˜•ì‹ì„ ìƒˆë¡œìš´ ìŠ¤í‚¤ë§ˆë¡œ ì •ê·œí™”í•©ë‹ˆë‹¤.

    Returns:
        List[Dict]: ì •ê·œí™”ëœ ì‚¬ìš©ì í”„ë¡œí•„ ëª©ë¡
    """
    users_data = load_users_data()
    main_data = initialize_data()

    # ê¸°ì¡´ ë“±ë¡ ì‚¬ìš©ì
    users = list(users_data["users"].values())

    # ìŠ¹ì¸ëœ ì‚¬ìš©ì ì¶”ê°€
    approved_users = main_data.get("approved_users", {})
    for username, approved_user in approved_users.items():
        # ìŠ¹ì¸ëœ ì‚¬ìš©ìë¥¼ í‘œì¤€ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        user_profile = {
            "user_id": f"approved_{username}",
            "nox_id": approved_user.get("nox_id", username),
            "nickname": approved_user.get("name", username),
            "department": approved_user.get("department", "ê¸°íƒ€"),
            "created_at": approved_user.get("approved_at", datetime.now().isoformat()),
            "last_login": None,
            "is_active": True,
            "user_type": "approved"  # êµ¬ë¶„ì„ ìœ„í•œ íƒœê·¸
        }
        users.append(user_profile)

    # ë ˆê±°ì‹œ ë°ì´í„°ë¥¼ ìƒˆ í‘œì¤€ í˜•ì‹ìœ¼ë¡œ ì •ê·œí™” (ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜)
    normalized_users = []
    for user in users:
        # ê¸°ì¡´ ë‹¤ì–‘í•œ í•„ë“œëª…ì„ í‘œì¤€ í˜•ì‹ìœ¼ë¡œ í†µì¼
        if "nox_id" not in user:
            user["nox_id"] = user.get("username", f"user_{user.get('user_id', 'unknown')[:8]}")
        if "nickname" not in user:
            user["nickname"] = user.get("display_name", user.get("username", "ì‚¬ìš©ì"))
        if "department" not in user:
            user["department"] = "ê¸°íƒ€"
        if "is_active" not in user:
            user["is_active"] = True
        if "user_type" not in user:
            user["user_type"] = "regular"  # ê¸°ë³¸ê°’

        normalized_users.append(user)

    return normalized_users
```

**ğŸŸ¢ ìˆ˜ì • í›„:**
```python
def get_all_users() -> List[Dict]:
    """
    ì „ì²´ ì‚¬ìš©ì ëª©ë¡ ë°˜í™˜ (ìƒˆ í†µí•© ì‹œìŠ¤í…œ í™œìš©)

    users_management.jsonì˜ í™œì„± ì‚¬ìš©ì ëª©ë¡ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
    íšŒì›ê°€ì… â†’ ìŠ¹ì¸ â†’ í™œì„± ì‚¬ìš©ì í”Œë¡œìš°ê°€ ì™„ë£Œëœ ì‚¬ìš©ìë“¤ë§Œ í¬í•¨ë©ë‹ˆë‹¤.

    Returns:
        List[Dict]: í™œì„± ì‚¬ìš©ì í”„ë¡œí•„ ëª©ë¡
    """
    try:
        from user_manager import get_all_active_users
        active_users_dict = get_all_active_users()

        # ë”•ì…”ë„ˆë¦¬ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ë©° í˜¸í™˜ì„±ì„ ìœ„í•œ í•„ë“œ ë§¤í•‘
        users = []
        for username, user_data in active_users_dict.items():
            user_profile = {
                "user_id": user_data.get("user_id", f"user_{username}"),
                "nox_id": user_data.get("nox_id", username),
                "nickname": user_data.get("nickname", user_data.get("name", username)),
                "name": user_data.get("name", username),
                "department": user_data.get("department", "ê¸°íƒ€"),
                "created_at": user_data.get("created_at", user_data.get("approved_at", datetime.now().strftime("%Y-%m-%d %H:%M:%S"))),
                "last_login": user_data.get("last_login"),
                "is_active": user_data.get("is_active", True),
                "role": user_data.get("role", "user"),
                "approved_at": user_data.get("approved_at"),
                "approved_by": user_data.get("approved_by"),
                "user_type": "approved_active"  # ìŠ¹ì¸ ì™„ë£Œëœ í™œì„± ì‚¬ìš©ì
            }
            users.append(user_profile)

        return users

    except Exception as e:
        logger.error(f"í™œì„± ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: {e}")
        # í´ë°±: ê¸°ì¡´ ì‹œìŠ¤í…œ ì‚¬ìš©
        return get_all_users_legacy()

def get_all_users_legacy() -> List[Dict]:
    """
    ì „ì²´ ì‚¬ìš©ì ëª©ë¡ ë°˜í™˜ (ë ˆê±°ì‹œ ì‹œìŠ¤í…œìš©)

    ê¸°ì¡´ users_data.jsonê³¼ knowledge_data.json ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ëŠ” í´ë°± í•¨ìˆ˜
    """
    users_data = load_users_data()
    main_data = initialize_data()

    # ê¸°ì¡´ ë“±ë¡ ì‚¬ìš©ì
    users = list(users_data["users"].values())

    # ìŠ¹ì¸ëœ ì‚¬ìš©ì ì¶”ê°€
    approved_users = main_data.get("approved_users", {})
    for username, approved_user in approved_users.items():
        # ìŠ¹ì¸ëœ ì‚¬ìš©ìë¥¼ í‘œì¤€ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        user_profile = {
            "user_id": f"approved_{username}",
            "nox_id": approved_user.get("nox_id", username),
            "nickname": approved_user.get("name", username),
            "department": approved_user.get("department", "ê¸°íƒ€"),
            "created_at": approved_user.get("approved_at", datetime.now().isoformat()),
            "last_login": None,
            "is_active": True,
            "user_type": "approved"  # êµ¬ë¶„ì„ ìœ„í•œ íƒœê·¸
        }
        users.append(user_profile)

    # ë ˆê±°ì‹œ ë°ì´í„°ë¥¼ ìƒˆ í‘œì¤€ í˜•ì‹ìœ¼ë¡œ ì •ê·œí™” (ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜)
    normalized_users = []
    for user in users:
        # ê¸°ì¡´ ë‹¤ì–‘í•œ í•„ë“œëª…ì„ í‘œì¤€ í˜•ì‹ìœ¼ë¡œ í†µì¼
        if "nox_id" not in user:
            user["nox_id"] = user.get("username", f"user_{user.get('user_id', 'unknown')[:8]}")
        if "nickname" not in user:
            user["nickname"] = user.get("display_name", user.get("username", "ì‚¬ìš©ì"))
        if "department" not in user:
            user["department"] = "ê¸°íƒ€"
        if "is_active" not in user:
            user["is_active"] = True
        if "user_type" not in user:
            user["user_type"] = "regular"  # ê¸°ë³¸ê°’

        normalized_users.append(user)

    return normalized_users
```

#### ğŸ“ ìˆ˜ì • ìœ„ì¹˜: `toggle_user_status()` í•¨ìˆ˜ (892ë²ˆì§¸ ì¤„ë¶€í„°)

**ğŸ”´ ìˆ˜ì • ì „:**
```python
def toggle_user_status(user_id: str) -> bool:
    """
    ì‚¬ìš©ì ê³„ì • í™œì„±í™”/ë¹„í™œì„±í™” ìƒíƒœ í† ê¸€

    ê´€ë¦¬ìê°€ ì‚¬ìš©ì ê³„ì •ì„ ì¼ì‹œì •ì§€í•˜ê±°ë‚˜ ì¬í™œì„±í™”í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
    ë¹„í™œì„±í™”ëœ ê³„ì •ì€ ë¡œê·¸ì¸í•  ìˆ˜ ì—†ì§€ë§Œ ë°ì´í„°ëŠ” ë³´ì¡´ë©ë‹ˆë‹¤.

    Args:
        user_id: ìƒíƒœë¥¼ ë³€ê²½í•  ì‚¬ìš©ìì˜ ê³ ìœ  ID

    Returns:
        bool: ìƒíƒœ ë³€ê²½ ì„±ê³µ ì—¬ë¶€
    """
    users_data = load_users_data()

    if user_id in users_data["users"]:
        user_info = users_data["users"][user_id]
        user_info["is_active"] = not user_info.get("is_active", True)
        users_data["users"][user_id] = user_info
        save_users_data(users_data)
        return True

    return False
```

**ğŸŸ¢ ìˆ˜ì • í›„:**
```python
def toggle_user_status(user_id: str) -> bool:
    """
    ì‚¬ìš©ì ê³„ì • í™œì„±í™”/ë¹„í™œì„±í™” ìƒíƒœ í† ê¸€ (ìƒˆ í†µí•© ì‹œìŠ¤í…œ ì§€ì›)

    ê´€ë¦¬ìê°€ ì‚¬ìš©ì ê³„ì •ì„ ì¼ì‹œì •ì§€í•˜ê±°ë‚˜ ì¬í™œì„±í™”í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
    ë¹„í™œì„±í™”ëœ ê³„ì •ì€ ë¡œê·¸ì¸í•  ìˆ˜ ì—†ì§€ë§Œ ë°ì´í„°ëŠ” ë³´ì¡´ë©ë‹ˆë‹¤.

    Args:
        user_id: ìƒíƒœë¥¼ ë³€ê²½í•  ì‚¬ìš©ìì˜ ê³ ìœ  ID

    Returns:
        bool: ìƒíƒœ ë³€ê²½ ì„±ê³µ ì—¬ë¶€
    """
    try:
        # ìƒˆ í†µí•© ì‹œìŠ¤í…œ ë¨¼ì € ì‹œë„
        from user_manager import load_users_data as load_user_management_data, save_users_data as save_user_management_data

        user_management_data = load_user_management_data()

        # user_idë¡œ ì‚¬ìš©ì ì°¾ê¸° (nox_idê°€ ë  ìˆ˜ë„ ìˆê³  user_idê°€ ë  ìˆ˜ë„ ìˆìŒ)
        target_username = None
        for username, user_data in user_management_data.get("active_users", {}).items():
            if user_data.get("user_id") == user_id or username == user_id:
                target_username = username
                break

        if target_username:
            user_info = user_management_data["active_users"][target_username]
            user_info["is_active"] = not user_info.get("is_active", True)
            user_management_data["active_users"][target_username] = user_info
            return save_user_management_data(user_management_data)

        # í´ë°±: ë ˆê±°ì‹œ ì‹œìŠ¤í…œ ì‚¬ìš©
        return toggle_user_status_legacy(user_id)

    except Exception as e:
        logger.error(f"ì‚¬ìš©ì ìƒíƒœ í† ê¸€ ì‹¤íŒ¨: {e}")
        return toggle_user_status_legacy(user_id)

def toggle_user_status_legacy(user_id: str) -> bool:
    """ë ˆê±°ì‹œ ì‹œìŠ¤í…œìš© ì‚¬ìš©ì ìƒíƒœ í† ê¸€"""
    users_data = load_users_data()

    if user_id in users_data["users"]:
        user_info = users_data["users"][user_id]
        user_info["is_active"] = not user_info.get("is_active", True)
        users_data["users"][user_id] = user_info
        save_users_data(users_data)
        return True

    return False
```

#### ğŸ“ ìˆ˜ì • ìœ„ì¹˜: `delete_user()` í•¨ìˆ˜ (916ë²ˆì§¸ ì¤„ë¶€í„°)

**ğŸ”´ ìˆ˜ì • ì „:**
```python
def delete_user(user_id: str) -> bool:
    """
    ì‚¬ìš©ì ê³„ì • ì™„ì „ ì‚­ì œ

    ê´€ë¦¬ìê°€ ì‚¬ìš©ì ê³„ì •ì„ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
    ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ì‹ ì¤‘í•˜ê²Œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

    Args:
        user_id: ì‚­ì œí•  ì‚¬ìš©ìì˜ ê³ ìœ  ID (ì˜ˆ: "approved_testuser123" ë˜ëŠ” "testuser123")

    Returns:
        bool: ì‚­ì œ ì„±ê³µ ì—¬ë¶€
    """
    deleted = False

    # 1. users_data.jsonì—ì„œ ì‚­ì œ ì‹œë„
    users_data = load_users_data()
    if user_id in users_data["users"]:
        del users_data["users"][user_id]
        save_users_data(users_data)
        deleted = True

    # 2. knowledge_data.jsonì˜ approved_usersì—ì„œ ì‚­ì œ ì‹œë„
    main_data = initialize_data()

    # user_idê°€ "approved_" ì ‘ë‘ì‚¬ë¥¼ ê°€ì§„ ê²½ìš° ì‹¤ì œ username ì¶”ì¶œ
    if user_id.startswith("approved_"):
        actual_username = user_id.replace("approved_", "")
    else:
        actual_username = user_id

    # approved_usersì—ì„œ ì‚­ì œ
    if "approved_users" in main_data and actual_username in main_data["approved_users"]:
        del main_data["approved_users"][actual_username]

        # knowledge_data.jsonì— ì €ì¥
        try:
            with open(DATA_CONFIG["data_file"], 'w', encoding='utf-8') as f:
                import json
                json.dump(main_data, f, ensure_ascii=False, indent=2)
            deleted = True
        except Exception as e:
            print(f"Error saving main data: {e}")

    # 3. users_management.jsonì˜ active_usersì—ì„œ ì‚­ì œ ì‹œë„
    try:
        from user_manager import load_users_data as load_user_management_data, save_users_data as save_user_management_data

        user_management_data = load_user_management_data()
        if "active_users" in user_management_data and actual_username in user_management_data["active_users"]:
            del user_management_data["active_users"][actual_username]
            if save_user_management_data(user_management_data):
                deleted = True
            else:
                print(f"Error saving user management data")
    except Exception as e:
        print(f"Error accessing user_management.json: {e}")

    return deleted
```

**ğŸŸ¢ ìˆ˜ì • í›„:**
```python
def delete_user(user_id: str) -> bool:
    """
    ì‚¬ìš©ì ê³„ì • ì™„ì „ ì‚­ì œ (ìƒˆ í†µí•© ì‹œìŠ¤í…œ ìš°ì„  ì§€ì›)

    ê´€ë¦¬ìê°€ ì‚¬ìš©ì ê³„ì •ì„ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
    ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ì‹ ì¤‘í•˜ê²Œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

    Args:
        user_id: ì‚­ì œí•  ì‚¬ìš©ìì˜ ê³ ìœ  ID

    Returns:
        bool: ì‚­ì œ ì„±ê³µ ì—¬ë¶€
    """
    deleted = False

    try:
        # ìƒˆ í†µí•© ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©ì ì°¾ê¸° ë° ì‚­ì œ
        from user_manager import load_users_data as load_user_management_data, save_users_data as save_user_management_data

        user_management_data = load_user_management_data()

        # user_idë¡œ ì‚¬ìš©ì ì°¾ê¸° (nox_idê°€ ë  ìˆ˜ë„ ìˆê³  user_idê°€ ë  ìˆ˜ë„ ìˆìŒ)
        target_username = None
        for username, user_data in user_management_data.get("active_users", {}).items():
            if user_data.get("user_id") == user_id or username == user_id:
                target_username = username
                break

        if target_username and target_username in user_management_data["active_users"]:
            del user_management_data["active_users"][target_username]
            if save_user_management_data(user_management_data):
                deleted = True
                logger.info(f"ì‚¬ìš©ì {target_username} ì‚­ì œ ì™„ë£Œ (í†µí•© ì‹œìŠ¤í…œ)")

    except Exception as e:
        logger.error(f"ìƒˆ í†µí•© ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©ì ì‚­ì œ ì‹¤íŒ¨: {e}")

    # ë ˆê±°ì‹œ ì‹œìŠ¤í…œì—ì„œë„ ì‚­ì œ ì‹œë„ (ë°ì´í„° ì¼ê´€ì„±ì„ ìœ„í•´)
    if delete_user_legacy(user_id):
        deleted = True

    return deleted

def delete_user_legacy(user_id: str) -> bool:
    """ë ˆê±°ì‹œ ì‹œìŠ¤í…œìš© ì‚¬ìš©ì ì‚­ì œ"""
    deleted = False

    # 1. users_data.jsonì—ì„œ ì‚­ì œ ì‹œë„
    users_data = load_users_data()
    if user_id in users_data["users"]:
        del users_data["users"][user_id]
        save_users_data(users_data)
        deleted = True

    # 2. knowledge_data.jsonì˜ approved_usersì—ì„œ ì‚­ì œ ì‹œë„
    main_data = initialize_data()

    # user_idê°€ "approved_" ì ‘ë‘ì‚¬ë¥¼ ê°€ì§„ ê²½ìš° ì‹¤ì œ username ì¶”ì¶œ
    if user_id.startswith("approved_"):
        actual_username = user_id.replace("approved_", "")
    else:
        actual_username = user_id

    # approved_usersì—ì„œ ì‚­ì œ
    if "approved_users" in main_data and actual_username in main_data["approved_users"]:
        del main_data["approved_users"][actual_username]

        # knowledge_data.jsonì— ì €ì¥
        try:
            with open(DATA_CONFIG["data_file"], 'w', encoding='utf-8') as f:
                import json
                json.dump(main_data, f, ensure_ascii=False, indent=2)
            deleted = True
        except Exception as e:
            logger.error(f"ë©”ì¸ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨: {e}")

    return deleted
```

#### ğŸ“ ìˆ˜ì • ìœ„ì¹˜: `update_user_info()` í•¨ìˆ˜ (976ë²ˆì§¸ ì¤„ë¶€í„°)

**ğŸ”´ ìˆ˜ì • ì „:**
```python
def update_user_info(user_id: str, nickname: str, department: str) -> tuple[bool, str]:
    """
    ì‚¬ìš©ì í”„ë¡œí•„ ì •ë³´ ì—…ë°ì´íŠ¸

    ê´€ë¦¬ìê°€ ì‚¬ìš©ìì˜ ë‹‰ë„¤ì„ì´ë‚˜ ë¶€ì„œ ì •ë³´ë¥¼ ìˆ˜ì •í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
    ë‹‰ë„¤ì„ ì¤‘ë³µ ê²€ì‚¬ë¥¼ í¬í•¨í•˜ì—¬ ë°ì´í„° ë¬´ê²°ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.

    Args:
        user_id: ìˆ˜ì •í•  ì‚¬ìš©ìì˜ ê³ ìœ  ID
        nickname: ìƒˆë¡œìš´ ë‹‰ë„¤ì„
        department: ìƒˆë¡œìš´ ë¶€ì„œ

    Returns:
        tuple[bool, str]: (ìˆ˜ì • ì„±ê³µ ì—¬ë¶€, ê²°ê³¼ ë©”ì‹œì§€)
    """
    users_data = load_users_data()

    if user_id not in users_data["users"]:
        return False, "ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."

    # ë‹‰ë„¤ì„ ì¤‘ë³µ ê²€ì‚¬ (ë³¸ì¸ ì œì™¸)
    for uid, user_info in users_data["users"].items():
        if uid != user_id and user_info["nickname"] == nickname:
            return False, "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤."

    # ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
    users_data["users"][user_id]["nickname"] = nickname
    users_data["users"][user_id]["department"] = department
    save_users_data(users_data)

    return True, "ì‚¬ìš©ì ì •ë³´ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤."
```

**ğŸŸ¢ ìˆ˜ì • í›„:**
```python
def update_user_info(user_id: str, nickname: str, department: str) -> tuple[bool, str]:
    """
    ì‚¬ìš©ì í”„ë¡œí•„ ì •ë³´ ì—…ë°ì´íŠ¸ (ìƒˆ í†µí•© ì‹œìŠ¤í…œ ìš°ì„  ì§€ì›)

    ê´€ë¦¬ìê°€ ì‚¬ìš©ìì˜ ë‹‰ë„¤ì„ì´ë‚˜ ë¶€ì„œ ì •ë³´ë¥¼ ìˆ˜ì •í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
    ë‹‰ë„¤ì„ ì¤‘ë³µ ê²€ì‚¬ë¥¼ í¬í•¨í•˜ì—¬ ë°ì´í„° ë¬´ê²°ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.

    Args:
        user_id: ìˆ˜ì •í•  ì‚¬ìš©ìì˜ ê³ ìœ  ID
        nickname: ìƒˆë¡œìš´ ë‹‰ë„¤ì„
        department: ìƒˆë¡œìš´ ë¶€ì„œ

    Returns:
        tuple[bool, str]: (ìˆ˜ì • ì„±ê³µ ì—¬ë¶€, ê²°ê³¼ ë©”ì‹œì§€)
    """
    try:
        # ìƒˆ í†µí•© ì‹œìŠ¤í…œ ë¨¼ì € ì‹œë„
        from user_manager import load_users_data as load_user_management_data, save_users_data as save_user_management_data

        user_management_data = load_user_management_data()

        # user_idë¡œ ì‚¬ìš©ì ì°¾ê¸°
        target_username = None
        for username, user_data in user_management_data.get("active_users", {}).items():
            if user_data.get("user_id") == user_id or username == user_id:
                target_username = username
                break

        if not target_username:
            # í´ë°±: ë ˆê±°ì‹œ ì‹œìŠ¤í…œ ì‚¬ìš©
            return update_user_info_legacy(user_id, nickname, department)

        # ë‹‰ë„¤ì„ ì¤‘ë³µ ê²€ì‚¬ (ë³¸ì¸ ì œì™¸)
        for username, user_info in user_management_data.get("active_users", {}).items():
            if username != target_username and user_info.get("nickname") == nickname:
                return False, "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤."

        # ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
        user_management_data["active_users"][target_username]["nickname"] = nickname
        user_management_data["active_users"][target_username]["name"] = nickname  # name í•„ë“œë„ í•¨ê»˜ ì—…ë°ì´íŠ¸
        user_management_data["active_users"][target_username]["department"] = department

        if save_user_management_data(user_management_data):
            return True, "ì‚¬ìš©ì ì •ë³´ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤."
        else:
            return False, "ì‚¬ìš©ì ì •ë³´ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."

    except Exception as e:
        logger.error(f"ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: {e}")
        # í´ë°±: ë ˆê±°ì‹œ ì‹œìŠ¤í…œ ì‚¬ìš©
        return update_user_info_legacy(user_id, nickname, department)

def update_user_info_legacy(user_id: str, nickname: str, department: str) -> tuple[bool, str]:
    """ë ˆê±°ì‹œ ì‹œìŠ¤í…œìš© ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸"""
    users_data = load_users_data()

    if user_id not in users_data["users"]:
        return False, "ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."

    # ë‹‰ë„¤ì„ ì¤‘ë³µ ê²€ì‚¬ (ë³¸ì¸ ì œì™¸)
    for uid, user_info in users_data["users"].items():
        if uid != user_id and user_info["nickname"] == nickname:
            return False, "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤."

    # ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
    users_data["users"][user_id]["nickname"] = nickname
    users_data["users"][user_id]["department"] = department
    save_users_data(users_data)

    return True, "ì‚¬ìš©ì ì •ë³´ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤."
```

## ğŸ“Š ìˆ˜ì • ê²°ê³¼

### âœ… í•´ê²°ëœ ê¸°ëŠ¥ë“¤:
1. **íšŒì› ê´€ë¦¬ ëª©ë¡ í‘œì‹œ** - ìŠ¹ì¸ëœ ëª¨ë“  íšŒì›ì´ ì •ìƒ í‘œì‹œ
2. **íšŒì› ì •ë³´ ìˆ˜ì •** - ë‹‰ë„¤ì„, ë¶€ì„œ ë³€ê²½ ê¸°ëŠ¥ ì •ìƒ ì‘ë™
3. **íšŒì› ìƒíƒœ í† ê¸€** - í™œì„±/ë¹„í™œì„± ì „í™˜ ê¸°ëŠ¥ ì •ìƒ ì‘ë™
4. **íšŒì› ì‚­ì œ** - íšŒì› ê³„ì • ì‚­ì œ ê¸°ëŠ¥ ì •ìƒ ì‘ë™
5. **ê²€ìƒ‰ ê¸°ëŠ¥** - íšŒì› ê²€ìƒ‰ ê¸°ëŠ¥ ì •ìƒ ì‘ë™

### ğŸ”„ ì‹œìŠ¤í…œ ì—°ë™:
- **ìƒˆ í†µí•© ì‹œìŠ¤í…œ** (`users_management.json`) ìš°ì„  ì‚¬ìš©
- **ë ˆê±°ì‹œ ì‹œìŠ¤í…œ** í˜¸í™˜ì„± ìœ ì§€ (í´ë°± ê¸°ëŠ¥)
- **ë°ì´í„° ì¼ê´€ì„±** ë³´ì¥

## ğŸ¯ ì ìš© ë°©ë²•

1. `utils.py` íŒŒì¼ì˜ 763ë²ˆì§¸ ì¤„ë¶€í„° ìˆ˜ì •ëœ ì½”ë“œë¡œ êµì²´
2. ì´ 4ê°œ í•¨ìˆ˜ ìˆ˜ì •: `get_all_users()`, `toggle_user_status()`, `delete_user()`, `update_user_info()`
3. ê° í•¨ìˆ˜ë§ˆë‹¤ ë ˆê±°ì‹œ í˜¸í™˜ í•¨ìˆ˜ ì¶”ê°€
4. ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹… ê°•í™”

ì´ ìˆ˜ì •ìœ¼ë¡œ íšŒì›ê°€ì… â†’ ìŠ¹ì¸ â†’ íšŒì› ê´€ë¦¬ ì „ì²´ í”Œë¡œìš°ê°€ ì™„ì „íˆ ì—°ë™ë©ë‹ˆë‹¤.